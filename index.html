<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>¡Aventuras lingüísticas!</title>
    <style>
    /* Global Styles */
    * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
        font-family: 'Comic Sans MS', 'Chalkboard SE', 'Marker Felt', cursive, sans-serif;
    }
    
    body {
        background-color: #f9f0e8;
        overflow-x: hidden;
    }
 
/* Gradient on left and right edges */
body::before,
body::after {
    content: "";
    position: fixed;
    top: 0;
    width: 15vw; /* Adjusts gradient width */
    height: 100vh;
    pointer-events: none;
    z-index: 1; /* Ensure it overlays correctly */
}

body::before {
    left: 0;
    background: linear-gradient(to right, rgba(0, 9, 33, 0.3), rgba(0, 9, 33, 0));
}

body::after {
    right: 0;
    background: linear-gradient(to left, rgba(0, 9, 33, 0.3), rgba(0, 9, 33, 0));
}

    /* Game Page Styles */
    .game-container {
        width: 100vw;
        min-height: 100vh;
        padding: 20px;
        background: linear-gradient(45deg, #7ABFFF, #8CA9F2, #9B93E7, #B07BDC, #C462D0, #DA47C3);
        background-size: 400% 400%;
        animation: gradient 15s ease infinite;
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
    }
    
    @keyframes gradient {
        0% { background-position: 0% 50%; }
        50% { background-position: 100% 50%; }
        100% { background-position: 0% 50%; }
    }

    /* Improved SVG overlay positioning */
    .svg-overlay {
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        width: 100%;
        height: 100%;
        pointer-events: none;
        z-index: 0;
        opacity: 0.15; /* Kept your original opacity setting */
    }

.svg-overlay svg {
    width: 100vw;
    height: 100vh;
}

    /* Make sure other content is positioned above the SVG */
    .score-container, .home-button, .manuscript {
        position: relative;
        z-index: 1;
    }

        /* Make sure other content is positioned above the SVG */
        .score-container, .home-button, .manuscript {
            position: relative;
            z-index: 1;
        }
        
        .score-container {
            position: fixed;
            top: 20px;
            right: 20px;
            background: rgba(255, 255, 255, 0.85);
            padding: 10px 20px;
            border-radius: 20px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);
            z-index: 100;
            font-size: 1.2rem;
            font-weight: bold;
        }
        
        .correct-count {
            color: green;
            font-weight: bold;
        }
        
        .manuscript {
            width: 90%;
            max-width: 600px;
            margin: 20px auto;
            background-color: rgba(255, 251, 240, 0.92);
            padding: 25px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            position: relative;
            overflow: hidden;
            border-radius: 20px;
        }
        
        .manuscript::before {
            content: "";
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            opacity: 0.08;
            z-index: -1;
            background-image: url('/api/placeholder/400/400');
            background-size: cover;
        }
        
.instruction-text {
    text-align: center;
    color: purple;
    font-size: 1.3rem;
    margin-bottom: 15px;
    font-weight: bold;
}

        .character-image {
            width: 120px;
            height: 120px;
            margin: 0 auto 20px;
            display: block;
            background-size: contain;
            background-repeat: no-repeat;
            background-position: center;
            animation: pulse 2s infinite;
        }
        
        .english-sentence {
            font-size: 1.4rem;
            color: #333;
            text-align: center;
            margin-bottom: 25px;
            padding: 15px;
            border-radius: 15px;
            background-color: rgba(255, 255, 255, 0.7);
            font-weight: 500;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            line-height: 1.4;
        }
        
        .spanish-options {
            display: flex;
            flex-direction: column;
            gap: 15px;
            margin-top: 25px;
        }
        
        .spanish-option {
            font-size: 1.2rem;
            padding: 15px;
            background-color: white;
            border: 3px solid #8a64ba;
            border-radius: 15px;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 3px 6px rgba(0, 0, 0, 0.1);
        }
        
        .spanish-option:hover {
            background-color: #f1e3ff;
            transform: translateX(5px) scale(1.02);
            box-shadow: 0 5px 12px rgba(0, 0, 0, 0.15);
        }
        
        .correct {
            background-color: #aaffaa !important;
            border-color: green !important;
            animation: correct-answer 0.5s;
        }
        
        @keyframes correct-answer {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }
        
        .incorrect {
            background-color: #ffaaaa !important;
            border-color: red !important;
            animation: shake 0.5s;
        }
        
        .translation-hint {
            margin-top: 20px;
            padding: 15px;
            background-color: #fff8e1;
            border-radius: 12px;
            font-size: 1rem;
            border-left: 4px solid #ffc107;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }
        
        .celebration {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            pointer-events: none;
            z-index: 100;
            display: none;
        }
        
        .confetti {
            position: absolute;
            width: 15px;
            height: 15px;
            background-color: #f00;
            opacity: 0.8;
            animation: confetti-fall 4s linear forwards;
        }
        
        /* Animations */
        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }
        
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            10%, 30%, 50%, 70%, 90% { transform: translateX(-5px); }
            20%, 40%, 60%, 80% { transform: translateX(5px); }
        }
        
        @keyframes confetti-fall {
            0% { transform: translateY(-50px) rotate(0deg); opacity: 1; }
            100% { transform: translateY(100vh) rotate(360deg); opacity: 0; }
        }
/* Modal Overlay for the Matching Game */
.modal-overlay {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background-color: rgba(0, 0, 0, 0.6);
    display: flex;
    justify-content: center;
    align-items: center;
    z-index: 1000;
    display: none;
}

.matching-modal {
    width: 90%;
    max-width: 600px;
    background-color: rgba(255, 251, 240, 0.95);
    border-radius: 20px;
    padding: 25px;
    box-shadow: 0 5px 30px rgba(0, 0, 0, 0.4);
    position: relative;
}

.modal-title {
    text-align: center;
    color: purple;
    font-size: 1.3rem;
    margin-bottom: 20px;
    font-weight: bold;
}

.original-sentence {
    text-align: center;
    padding: 15px;
    background-color: rgba(255, 255, 255, 0.6);
    border-radius: 10px;
    margin-bottom: 20px;
    font-size: 1.2rem;
    color: #333;
    border: 2px dashed #8a64ba;
}

.matching-area {
    display: flex;
    flex-direction: column;
    gap: 30px;
}

.component-title {
    font-weight: bold;
    color: #8a64ba;
    margin-bottom: 5px;
}

.match-container {
    display: flex;
    margin-bottom: 15px;
}

.match-container .english-component {
    flex: 1;
    margin-right: 15px;
    background-color: #85296a;
    color: white;
    border: 2px solid #6a2055;
    border-radius: 10px;
    padding: 12px;
}

.match-container .spanish-dropzone {
    flex: 1;
    background-color: #d9c7d6;
    border: 2px dashed #85296a;
    border-radius: 10px;
    padding: 12px;
    min-height: 50px;
    transition: all 0.3s;
}

.spanish-dropzone.highlight {
    background-color: #c4a0be;
    border-style: solid;
}

.spanish-options-matching {
    display: flex;
    flex-wrap: wrap;
    gap: 10px;
    margin-top: 20px;
    padding: 15px;
    background-color: rgba(255, 255, 255, 0.6);
    border-radius: 10px;
    justify-content: center;
}

.draggable {
    cursor: grab;
    background-color: #3e3364;
    color: white;
    border: 2px solid #2a234a;
    border-radius: 10px;
    padding: 10px;
    margin: 5px;
    transition: all 0.3s;
}

.draggable:hover {
    background-color: #4e4174;
    transform: translateY(-3px);
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
}

.draggable:active {
    cursor: grabbing;
}

.draggable.dragging {
    opacity: 0.5;
}

.draggable.speaking {
    background-color: #604c8d;
}

.check-matches-btn {
    background-color: #85296a;
    color: white;
    border: none;
    border-radius: 20px;
    padding: 12px 25px;
    font-size: 1.1rem;
    cursor: pointer;
    transition: all 0.3s;
    margin-top: 20px;
    width: 100%;
    max-width: 200px;
    align-self: center;
    box-shadow: 0 3px 6px rgba(0, 0, 0, 0.2);
}

.check-matches-btn:hover {
    background-color: #6a2055;
    transform: translateY(-2px);
    box-shadow: 0 5px 10px rgba(0, 0, 0, 0.3);
}

.check-matches-btn:disabled {
    background-color: #cccccc;
    cursor: not-allowed;
    transform: none;
    box-shadow: none;
}

.result-message {
    text-align: center;
    margin-top: 15px;
    font-weight: bold;
    color: green;
    height: 24px;
}

.correct-match {
    background-color: #aaffaa !important;
    border-color: green !important;
    animation: correct-answer 0.5s;
}

.incorrect-match {
    background-color: #ffaaaa !important;
    border-color: red !important;
    animation: shake 0.5s;
}
    </style>
</head>
<body>
    <div class="game-container">
        <div class="logo-left">
            <img src="Adventuras%20Linguisticas%20Bears%20Logo.svg"
                 alt="¡Aventuras lingüísticas! logo">
          </div>
                
<div class="svg-overlay">
  <svg id="Layer_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" viewBox="0 0 5600 3400">
    <!-- Generator: Adobe Illustrator 29.3.1, SVG Export Plug-In . SVG Version: 2.1.0 Build 151)  -->
    <defs>
      <style>
        .st0 {
          fill: url(#linear-gradient1);
        }

        .st1 {
          fill: #eae8dc;
        }

        .st2 {
          fill: url(#linear-gradient);
        }

        .st3 {
          fill: #c6c2b3;
        }

        .st4 {
          fill: #eae8bc;
        }

        /* Position logo top-left without affecting content layout */

.logo-left {
  position: absolute;
  top: 20px;
  left: 20px;
  z-index: 5;
}

.logo-left img {
  width: 200px;
  height: auto;
  pointer-events: none;
  user-select: none;
}

@media (max-width: 768px) {
  .logo, .logo svg, .svg-overlay {
    display: none !important;
  }
}
      </style>
<linearGradient id="edge-gradient" x1="0" y1="0" x2="1" y2="0">
    <stop offset="0" stop-color="rgba(0, 9, 33, 0.3)"/>
    <stop offset="1" stop-color="rgba(0, 9, 33, 0)"/>
</linearGradient>
    </defs>
          <g>
            <g>
              <g>
                <g>
                  <path class="st4" d="M1345.06,2283.85c-1.19-1.48-5.01-3.91-8.38-5.27-3.42-1.38-5.08-5.27-3.7-8.69.96-2.4,3.18-3.86,5.59-4.09-28.46-3.14-66.76-16.83-99.28-30.42,34.32,21.8,70.2,40.49,103.34,50.56.67-.24,1.8-.81,2.44-2.09h0Z"/>
                  <path class="st4" d="M1115,1822.57c2.87.11,5.75.3,8.63.56,1.25-4.4,3.31-8.9,6.5-13.3,1.81-2.5,4.45-4.45,7.64-5.95-6.75-1.33-14.75-.9-21.73,2.36-2.77,1.29-3.51,2.83-3.83,3.87-1.29,4.2,1.66,10.56,2.79,12.45h0s0,.01,0,.01Z"/>
                  <path class="st4" d="M1341.66,2266.1v-.03c-.35-.03-.72-.06-1.09-.09.36.08.72.06,1.07.2,0-.02,0-.05.01-.07h.01Z"/>
                  <g>
                    <path class="st4" d="M1358.19,2286.81c-.3,1.07-.69,2.05-1.14,2.96.91.21,1.83.46,2.73.65l33.53-88.41-10.74-4.88-28.44,73.78c-.29.77-.74,1.42-1.25,2,4.27,3.81,6.85,8.54,5.31,13.91h0Z"/>
                    <path class="st4" d="M1296.83,2449.02l10.94,2.99,4.87-13.52c-4,.63-8.09,1.22-12.28,1.72l-3.53,8.81h0Z"/>
                  </g>
                  <path class="st4" d="M1215.5,2013.53c5.69,0,12.3-5.51,20.81-17.33,6.34-8.82,5.68-14.57,4-17.83-1.87-3.65-5.82-5.75-10.84-5.75-5.28,0-11.05,2.35-15.82,6.44-11.96,10.26-9.26,23.5-6.18,29.03,2.42,4.5,5.7,5.45,8.03,5.45h0Z"/>
                  <path class="st4" d="M1562.78,2238.51l-152.3-62.39c-1.66-.68-3.54-.66-5.19.05-1.66.72-2.95,2.07-3.59,3.76l-3.63,9.56-16.42-7.46c-1.67-.76-3.59-.8-5.29-.1-1.7.7-3.04,2.07-3.71,3.78l-25.94,67.29c-54.22-2.16-165.57-59.11-166.71-59.69-.36-.19-.74-.2-1.12-.32-14.75-11.3-28.51-22.52-40.84-33.08,6.72-10.13,25.64-28.26,49.45-23.07,65.86,14.28,99.77-25.6,116.59-50.37,6.45-4.06,14.18-13.98,16.77-19.6,3.2-6.95,3.79-13.12,1.74-18.34-3.12-7.93-11.59-12.34-20.29-15.91l-1.64-.68c-4.75-5.08-9.93-10.84-14.82-18.43-10.69-16.58-12.13-32.27-13.8-50.44-1.74-18.81-3.7-40.14-17.08-64.83-10.19-18.82-24.55-34.5-42.63-46.75.8-3.14,1.51-6.61,2.06-10.57,2.04-14.7-7.48-27.43-26.12-34.91-8.79-3.53-19.19-5.61-28.88-5.83-10.64-10.83-32.48-13.78-49.02-6.06-5.57,2.6-9.37,6.8-10.98,12.14-1.76,5.83-.56,11.8,1,16.27-91.03,3.5-177.26,72.01-235.73,132.03-102.26,104.97-154.52,205.2-179.63,267.78-37.97,97.11-57.8,313.62-30.23,465.81,16.85,41.22,45.28,108.25,114.16,154.54,73.45,49.36,156.68,51.67,207.6,51.67,55.84,0,111.48-7.36,161.3-15.85,51.54-8.77,116.17-6.25,168.13-4.22,45.34,1.77,69.49,2.49,79.53-2.09,69.94-31.79,79.83-118.56,75.51-146.57-1.63-10.6-8.37-18.06-18.97-21.01-15.19-4.24-34.32,1.62-43.23,9.98-2.6-.29-7.42-2.76-13.32-6.3,5.23-4.8,12.26-12.11,18.36-21.64,12.66-19.78,20.04-46.13,6.33-57.22-11.16-9.04-26.53-5.23-33.9-2.56-15.64-13.48-84.13-69.28-144.86-68-7.57-49.37-28.56-86.39-36.77-99.28-5.44-8.55-8.86-14.38-11.09-18.38,19.39,1.45,38.59,2.25,57.07,2.25,15.51,0,30.51-.56,44.68-1.73l-3.71,9.28c-.71,1.77-.63,3.76.22,5.47.85,1.7,2.38,2.97,4.22,3.47l17.15,4.68-4.25,11.8c-.67,1.86-.48,3.92.51,5.62.99,1.7,2.68,2.88,4.63,3.22l166.6,29.06c.39.07.77.1,1.15.1,2.75,0,5.27-1.7,6.25-4.35l93.55-250.71c2.14-5.88,1.06-10.31-.23-12.99-2.7-5.63-8.02-7.67-8.67-7.87h.03,0ZM1354.13,2270.91l28.44-73.78,10.74,4.88-33.53,88.41c-.9-.19-1.83-.44-2.73-.65.45-.91.83-1.89,1.14-2.96,1.54-5.37-1.04-10.09-5.31-13.91.51-.58.96-1.23,1.25-2h0ZM1341.67,2266.07v.03s-.02.05-.02.07c-.35-.14-.72-.12-1.07-.2.37.03.73.06,1.1.09h-.01ZM1338.58,2265.8c-2.41.23-4.63,1.69-5.59,4.09-1.38,3.42.28,7.31,3.7,8.69,3.37,1.36,7.19,3.8,8.38,5.27-.63,1.28-1.76,1.85-2.44,2.09-33.13-10.07-69.02-28.76-103.34-50.56,32.53,13.59,70.82,27.28,99.28,30.42h0ZM1112.2,1810.1c.32-1.04,1.06-2.57,3.83-3.87,6.98-3.26,14.98-3.69,21.73-2.36-3.19,1.5-5.83,3.45-7.64,5.95-3.19,4.4-5.25,8.9-6.5,13.3-2.88-.25-5.75-.44-8.63-.56h0c-1.14-1.9-4.08-8.26-2.79-12.46h0ZM1232.83,2619.17c1.82-16.41,1.71-32.12.28-46.92h0c62-.15,136.64,66.63,137.42,67.33,2.03,1.84,4.98,2.25,7.43,1.04,4.01-1.97,16.99-6.34,23.84-.81,5.68,4.6,1.39,23.12-9.18,39.63-6.49,10.14-14.32,17.55-18.81,21.37-5.73-3.81-11.78-7.98-17.61-12M684.96,2281.79c26.39-90.71,69.12-176.82,172.74-298.38,120.23-141.04,206.67-129.13,269.35-147.06.41,13.12,6.14,23.24,6.54,23.91,1.86,3.18,5.92,4.25,9.11,2.41s4.28-5.92,2.46-9.12c-.45-.8-11-19.66.79-35.94,3.52-4.86,24.33-6.5,42.34.74,7.33,2.95,19.4,9.55,17.86,20.68-2.73,19.75-9.58,25.12-9.55,25.12-3.15,1.92-4.15,6.03-2.23,9.19,1.26,2.07,3.46,3.21,5.71,3.21,1.19,0,2.38-.32,3.47-.98,1.18-.72,5.21-3.63,9.05-11.18,15,10.74,26.97,24.21,35.61,40.15,12.07,22.28,13.82,41.3,15.51,59.69,1.76,19.09,3.42,37.12,15.88,56.46,4.6,7.13,9.44,12.86,13.82,17.66v.37c0,3.79.74,7.91,1.53,12.27,1.27,7.03,2.7,14.99,1.41,23.62-.5,3.36-.8,5.99-.95,8.1-16.6,23.53-45.13,52.93-100.09,41.01-29.1-6.31-52.46,13.28-62.44,27.3-4.86-4.3-9.47-8.46-13.73-12.41-55.53-51.56-106.99-52.15-109.15-52.15-3.68,0-6.66,2.98-6.67,6.66-.01,3.68,2.97,6.68,6.65,6.7.48,0,48.65.82,100.08,48.58,61.45,57.06,189.26,154.6,278.95,158.67,12.24,2.01,21.59,13.59,23.88,29.62,3.22,22.59-8.25,55.99-51.19,75.82-84.2,38.86-319.93,6.11-395-34.68l.02.06h0c-3.24-1.76-7.3-.56-9.06,2.68s-.56,7.3,2.68,9.06c40.99,22.27,127.15,42.37,212.57,50.28,1.38,3.13,5.21,10.71,15.5,26.86,10.59,16.65,43.75,75.71,36.32,148.99-59.95-13.23-110.06,6.78-112.65,7.84-3.41,1.4-5.04,5.29-3.64,8.71s5.31,5.05,8.71,3.65c.73-.3,73.73-29.32,145.52,7.51,36.21,18.57,66.55,39.52,90.93,56.34,7.99,5.52,14.84,10.21,20.77,14.11.66.65,1.43,1.14,2.26,1.46,16.76,10.82,25.9,14.67,33.12,11.57.97-.41,1.83-1.05,2.5-1.86,4.35-5.22,20.1-10.71,31.22-7.62,5.54,1.54,8.51,4.77,9.34,10.16,3.9,25.34-4.93,103.78-67.83,132.37-7.64,3.47-39.62,2.24-73.49.9-52.55-2.04-117.96-4.6-170.89,4.4-112.59,19.17-255.19,32.63-359.46-33.92-16.35-10.43-54.2-34.73-81.98-82.23-19.61-33.52-26.56-65.44-29.34-86-8.5-43.47-16.02-101.38-14.37-169.58,2.42-99.88,19.13-176.12,29.5-211.77ZM1307.78,2452.01l-10.94-2.99,3.53-8.81c4.2-.51,8.28-1.09,12.28-1.72l-4.87,13.52h0ZM1559.14,2254.75l-91.59,245.46-153.29-26.74,13.61-37.82c12.98-2.81,24.62-6.42,34.45-10.96,49.62-22.9,62.7-62.71,58.83-89.84-3.16-22.15-17.08-38.25-35.45-41-.24-.04-.47-.06-.71-.07-3.84-.16-7.78-.57-11.76-1.09l38.54-101.61,146.34,59.93s.99.51,1.3,1.15c.24.51.14,1.47-.26,2.59h-.01Z"/>
                </g>
                <path class="st4" d="M1307.21,2047.19s-1.94,2.91,0,5.81,6.78,5.81,6.78.97-4.36-10.65-6.78-6.78Z"/>
              </g>
              <g>
                <polygon class="st4" points="1440.7 2280.81 1488.05 2296.85 1495.41 2275.38 1448.79 2257.8 1440.7 2280.81"/>
                <path class="st4" d="M1506.19,2265.16l-59.08-22.28c-1.68-.63-3.55-.56-5.18.2s-2.89,2.15-3.48,3.84l-12.59,35.84c-.59,1.69-.49,3.54.3,5.14.78,1.61,2.17,2.83,3.86,3.41l60.05,20.34c.71.24,1.44.35,2.15.35,2.78,0,5.37-1.75,6.32-4.52l11.62-33.9c1.17-3.42-.58-7.15-3.96-8.42h-.01ZM1488.05,2296.85l-47.34-16.04,8.08-23.01,46.62,17.58-7.36,21.47h0Z"/>
              </g>
            </g>
            <path class="st4" d="M1215.5,2013.53c5.69,0,12.3-5.51,20.81-17.33,6.34-8.82,5.68-14.57,4-17.83-1.87-3.65-5.82-5.75-10.84-5.75-5.28,0-11.05,2.35-15.82,6.44-11.96,10.26-9.26,23.5-6.18,29.03,2.42,4.5,5.7,5.45,8.03,5.45h0Z"/>
          </g>
          <g>
            <g>
              <path class="st3" d="M642.86,2277.32c-2.42-2.84-5.42-5.73-7.83-6.8-.77,1.24-1.61,3.78-2.09,6.21,1.83,1.6,3.61,3.3,5.37,5.05,1.4-1.51,2.92-3.03,4.55-4.47h0Z"/>
              <polygon class="st3" points="343.7 2254.19 325.18 2243.43 322.68 2247.17 340.54 2259.07 343.7 2254.19"/>
<path class="st3" d="M664.75,2270.31c-3.46-1.3-6.96-1.09-10.34-.02-3.41-4.35-9.78-11.24-17.05-13.06-3.31-.82-6.66-.24-9.44,1.68-3.12,2.14-5.12,5.66-6.4,9.05-38.45-25.87-85.61-23.92-102.29-11.39-13.74,10.33-25.72,9.62-37.26,8.44-2.13-2.44-5.5-4.18-9.04-5.68-3.43-1.45-6.71-2.19-9.74-2.19-13.21,0-17.83,12.99-19.57,17.88-3.15,8.87-1.51,16.73-.7,19.59-.85,3.35-1.68,6.89-2.55,10.61l-1.53,6.53c-4.68,19.72,2.69,39.84,11.36,55.19-17.1-11.42-40.28-30.06-61.65-57.54l33.02-47.86c1.84-2.68,1.5-6.29-.83-8.57l-3.66-3.58,2.22-3.01c1.15-1.56,1.57-3.54,1.14-5.43-.42-1.89-1.64-3.5-3.35-4.42l-90.76-49c-1.94-1.25-5.03-2.26-8.47-1.71-2.74.44-6.76,2.05-10.39,7.24-5.68,8.11-84.46,121.92-89.82,129.66-3.55,3.97-4.9,10.43-.73,15.65,4.99,6.25,63.68,57.68,75.4,67.93,1.23,1.07,2.79,1.65,4.4,1.65.24,0,.48-.01.72-.04,1.86-.2,3.55-1.17,4.66-2.68l4.46-6.04,4.47,3.48c1.18.92,2.62,1.41,4.1,1.41.3,0,.6-.02.89-.06,1.76-.24,3.34-1.17,4.41-2.58,10.75,28.89,29.68,61,46.01,82.78,14.29,19.06,32.06,35.14,47.3,47.12-3.49,13.5-17.58,44.93-37.55,79.17-2.4,4.12-4.5,8.12-6.39,12.01-10.56-1.7-39.09-3.04-76.5,21.36-16.58,10.91-23.98,15.35-27.12,17.12-1.72-.62-3.97-1.29-6.43-1.66-8.3-1.26-14.93,1.75-18.15,8.19-6.81,13.62,12.17,46.2,24.64,57.97,1.96,1.85,4,3.08,6.04,3.89-5.82,5.66-10.31,10.4-13.02,13.38-6.09-1.57-17.19-3.23-27.02,1.68-5.49,2.74-8.83,8.01-9.4,14.82-1.95,22.99,28.33,66.63,47.67,80.81,7.55,5.53,14.58,7.53,21.72,7.53,8.06,0,16.25-2.55,25.46-5.41,10.64-3.31,23.88-7.42,41.84-9.6,20.6-2.5,34.79.39,51.23,3.72,21.03,4.26,44.87,9.09,88.37,4.98,168.18-23.7,187.32-219.83,173.76-380.2-.52-6.12-.93-10.96-.93-12.88,0-7.2.52-17.7,1.08-28.81,1.42-28.52,3.04-60.84-1.27-75.92-1.06-4.38-2.34-8.6-3.73-12.73,7.74-2.02,15.24-5.88,18.36-13.25,2.91-6.87,2.32-15.78-1.66-25.08-4.52-10.56-19.99-22.12-19.99-22.12h0ZM635.03,2270.52c2.42,1.06,5.42,3.95,7.83,6.8-1.64,1.44-3.16,2.96-4.55,4.47-1.76-1.75-3.54-3.45-5.37-5.05.47-2.43,1.32-4.97,2.09-6.21h0ZM467.62,2392.57h.01c-.08,3.22-.43,7.67-1.38,11.62-18.19-8.8-50.65-30.77-83.47-70.62-2.62-3.19-5.34-5.91-8.09-8.34-.04-.22-.1-.43-.14-.65,2.54,2.33,6.43,2.32,9-.01M313.06,2352.06c-1.31,4.87-1.46,10.66-.84,16.97l-16.54,22.41c-25.27-22.16-60.83-53.7-67.44-60.51.05-.07.1-.14.15-.21.84-1.21,84.23-121.68,90.05-130,.58-.83,1.06-1.3,1.36-1.54l84.19,45.45-51.43,69.71c-3.1-.35-6.19-.26-9.23.4-13.86,3-24.61,16.25-30.28,37.31h.01ZM364.22,2635.33c-7.55,19.52-8.95,34.22-9.21,39.2-24.35,7.89-47.59,24.13-65.41,39.18-.09.03-.19.02-.28.06-.64.27-1.39.62-2.22,1.02-5.75,2.72-8.97,3.59-11.69,1.02-12.41-11.72-23.73-36.96-21.86-42.27l.02-.03c1.23-2.49,8.11-.08,9.92.81M674.11,2312.3c-2.29,5.4-17.16,7.62-27.05,7.15-3.65-.2-6.82,2.66-7,6.35s2.66,6.82,6.34,7c.79.04,2.05.09,3.64.09,1.31,0,2.85-.04,4.54-.13,1.59,4.48,3.06,9.13,4.29,14.16,3.77,13.21,2.08,47.09.84,71.84-.59,11.77-1.1,21.94-1.1,29.48,0,2.48.39,7.06.98,14,13.08,154.62-4.47,343.59-162,365.8-41.2,3.88-64.03-.74-84.16-4.81-16.84-3.42-32.76-6.63-55.49-3.89-19.17,2.32-33.05,6.63-44.2,10.1-16.94,5.26-24.68,7.66-35.31-.14-17.47-12.81-43.63-52.69-42.26-68.9.26-3.1,1.44-3.68,2.07-4,8.72-4.35,20.58.19,20.68.23,2.65,1.07,5.68.32,7.54-1.83.62-.72,62.63-71.78,116.98-71.78s84.96,16.36,85.32,16.56c3.2,1.81,7.27.7,9.1-2.5,1.83-3.2.72-7.29-2.49-9.11-1.31-.75-32.73-18.32-91.94-18.32-4.88,0-9.79.49-14.68,1.37,1.09-9.28,4.98-29.75,19-53.79,14.82-25.39,31.01-57.74,37.4-77.32,12.15,8.75,20.95,13.89,21.78,14.37,1.05.6,2.2.89,3.33.89,2.31,0,4.56-1.2,5.79-3.35,1.84-3.2.74-7.29-2.45-9.13-.23-.14-11.82-6.89-27.01-18.41-.71-1-1.7-1.73-2.86-2.22-14.93-11.57-32.69-27.36-46.57-45.88-29.74-39.65-57.4-97.59-51.2-120.65,4.24-15.76,11.61-25.86,20.2-27.72,2.32-.5,4.77-.36,7.29.27.23.07.45.15.69.19,5.91,1.7,12.2,6.34,18.33,13.79,48.21,58.54,91.07,75.78,95.79,77.56,10.29,3.86,21.18,5.8,30.8,7.51,10.61,1.89,21.58,3.84,24.23,7.55,2.15,3.01,6.33,3.7,9.32,1.56,3.01-2.15,3.7-6.32,1.56-9.32-5.81-8.14-18.3-10.36-32.75-12.94-7.18-1.28-15.1-2.73-22.64-4.97,2.58-9.08,2.27-19.11,2.21-20.45-.07-1.6-.73-3.13-1.83-4.29-.35-.37-34.92-37.2-27.28-69.42l1.54-6.58c.69-2.98,1.34-5.67,1.95-8.17,3.47-1.48,6.05-4.86,8.73-8.39,2.95-3.87,6.29-8.26,10.77-10.59l1.18-.59c1.17-.57,2.63-1.29,3.99-2.26,12.46,1.3,29.17,2.59,47.23-10.99,13.96-10.49,67.57-11.12,102.85,25.24-1.5,2.97-.7,6.63,2.13,8.53,3.06,2.05,7.21,1.24,9.27-1.83,6.19-9.24,15.52-17.5,18.5-16.38,3.51,1.33,9.06,6.99,12.43,14.88,2.46,5.76,3.08,11.22,1.65,14.61v-.03h0Z"/>
              <path class="st3" d="M546.92,2290.53c-3.24,0-6.11,1.39-7.86,3.81-3.1,4.28-5.2,8.83-6.08,10.9-2.54,3.3-3.21,7.15-1.74,10.51,1.53,3.53,5.11,5.73,9.34,5.73,6.17,0,12.5-4.39,17.35-12.05,2.46-3.88,2.68-8.28.6-12.07-2.25-4.09-6.91-6.83-11.62-6.83h.01Z"/>
              <path class="st3" d="M342.47,2275.08c.45,0,.91-.05,1.36-.14,1.75-.36,3.28-1.41,4.25-2.91l10.65-16.46c.99-1.54,1.32-3.41.89-5.19-.43-1.78-1.56-3.3-3.14-4.22l-30.02-17.43c-3.06-1.77-6.96-.86-8.92,2.07l-9.68,14.53c-2.05,3.07-1.22,7.22,1.86,9.27l29.06,19.37c1.11.74,2.4,1.12,3.71,1.12h-.02,0ZM325.18,2243.43l18.53,10.76-3.16,4.89-17.86-11.9,2.49-3.74h0Z"/>
            </g>
            <path class="st3" d="M463.11,2264.56s3.81,1.27,4.08,3.52c.39,3.27-4.19,1.26-6.42-.5s.05-3.28,2.34-3.02h0Z"/>
          </g>
          <polygon class="st1" points="5334.16 2955.13 5254.51 2846.83 5126.9 2889.12 5205.28 2779.9 5125.62 2671.61 5253.72 2712.4 5332.1 2603.18 5332.89 2737.61 5460.99 2778.4 5333.38 2820.69 5334.16 2955.13"/>
          <polygon class="st1" points="5469.55 2382.32 5365.92 2349.31 5302.51 2437.68 5301.87 2328.92 5198.23 2295.92 5301.47 2261.7 5300.84 2152.94 5365.28 2240.56 5468.52 2206.34 5405.11 2294.7 5469.55 2382.32"/>
          <polygon class="st1" points="5297.75 722.32 5254.16 671.15 5192.02 696.8 5227.22 639.53 5183.63 588.36 5248.97 604.14 5284.16 546.87 5289.35 613.88 5354.69 629.66 5292.56 655.3 5297.75 722.32"/>

        </svg>
        </div>
        
        <div class="score-container">
            Score: <span class="correct-count">0</span>
        </div>
        
        <div class="manuscript">
            <div class="character-image" id="current-character"></div>
            
<div class="instruction-text">Seraphina please help the character choose the correct Spanish translation!</div>

            <div class="english-sentence" id="english-text">
                Loading question...
            </div>
            
            <div class="spanish-options" id="spanish-options">
                <!-- Options will be dynamically added here -->
            </div>
        </div>
    </div>
    <!-- Modal for Matching Game -->
<div class="modal-overlay" id="matching-modal-overlay">
    <div class="matching-modal">
        <div class="modal-title">¡Match the sentence parts!</div>
        
        <div class="original-sentence" id="original-sentence">
            <!-- Original Spanish sentence will go here -->
        </div>
        
        <div class="matching-area">
            <div>
                <div class="component-title">Match Spanish phrases to English translations:</div>
                <div class="english-components" id="english-components">
                    <!-- English components and dropzones will go here -->
                </div>
            </div>
            
            <div>
                <div class="component-title">Drag and Drop the Spanish Phrases:</div>
                <div class="spanish-options-matching" id="spanish-options-matching">
                    <!-- Spanish draggable components will go here -->
                </div>
            </div>
            
            <div class="result-message" id="match-result-message"></div>
            
            <div class="controls">
                <button class="check-matches-btn" id="check-matches-btn">Check Matches</button>
            </div>
        </div>
    </div>
</div>
<!-- Celebration overlay -->
<div class="celebration" id="celebration"></div>

<!-- Load large translation data first -->
<script src="translation-data.js"></script>

<!-- Main game logic -->
<script>
    // Game state variables
    let currentCharacterIndex = 0;
    let currentSentenceIndex = 0;
    let correctCount = 0;
    let currentCorrectOption = null;
    let recentlyUsedQuestions = [];
    const maxRecentQuestions = 10; // Adjust as needed

    // DOM elements
    const characterImage = document.getElementById('current-character');
    const englishText = document.getElementById('english-text');
    const spanishOptions = document.getElementById('spanish-options');
    const correctCountDisplay = document.querySelector('.correct-count');
    const celebration = document.getElementById('celebration');
        
        // Character SVG icons
        const characterIcons = {
            "Belle": "data:image/svg+xml;utf8,<svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 100 100\"><circle cx=\"50\" cy=\"35\" r=\"25\" fill=\"%23FFD700\"/><path d=\"M30 65 L50 40 L70 65 Z\" fill=\"%23FFCC99\"/><rect x=\"35\" y=\"65\" width=\"30\" height=\"20\" fill=\"%23FFB6C1\"/></svg>",
            "Cinderella": "data:image/svg+xml;utf8,<svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 100 100\"><circle cx=\"50\" cy=\"35\" r=\"25\" fill=\"%23ADD8E6\"/><path d=\"M30 65 L50 40 L70 65 Z\" fill=\"%23FFCC99\"/><rect x=\"35\" y=\"65\" width=\"30\" height=\"20\" fill=\"%238FBC8F\"/></svg>",
            "Mulan": "data:image/svg+xml;utf8,<svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 100 100\"><circle cx=\"50\" cy=\"35\" r=\"25\" fill=\"%23000000\"/><path d=\"M30 65 L50 40 L70 65 Z\" fill=\"%23FFCC99\"/><rect x=\"35\" y=\"65\" width=\"30\" height=\"20\" fill=\"%23CD5C5C\"/></svg>",
            "Aurora": "data:image/svg+xml;utf8,<svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 100 100\"><circle cx=\"50\" cy=\"35\" r=\"25\" fill=\"%23FFB6C1\"/><path d=\"M30 65 L50 40 L70 65 Z\" fill=\"%23FFCC99\"/><rect x=\"35\" y=\"65\" width=\"30\" height=\"20\" fill=\"%23DA70D6\"/></svg>",
            "default": "data:image/svg+xml;utf8,<svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 100 100\"><circle cx=\"50\" cy=\"40\" r=\"25\" fill=\"%23FFD700\"/><rect x=\"25\" y=\"70\" width=\"50\" height=\"20\" fill=\"%23A52A2A\"/></svg>"
        };
        
        // Initialize the game on page load
        window.addEventListener('DOMContentLoaded', function() {
            // Load the voices first (this can be asynchronous in some browsers)
            if (window.speechSynthesis) {
                // Pre-load the voices
                window.speechSynthesis.getVoices();
                
                // In Chrome and some other browsers, voices are loaded asynchronously
                if (speechSynthesis.onvoiceschanged !== undefined) {
                    speechSynthesis.onvoiceschanged = function() {
                        // Voices are now loaded
                        console.log("Voices loaded:", window.speechSynthesis.getVoices().length);
                        console.log(window.speechSynthesis.getVoices().map(v => `${v.name} | ${v.lang}`));
                    };
                }
            }
            
            loadQuestion();
        });
        
// Load a new question
function loadQuestion() {
    // Reset options container
    spanishOptions.innerHTML = '';
    
    // Remove any existing translation hint
    const existingHint = document.querySelector('.translation-hint');
    if (existingHint) {
        existingHint.remove();
    }
    
    // Select random character and sentence, avoiding recent questions
    let randomCharacterIndex, randomSentenceIndex, questionKey;
    let attempts = 0;
    const maxAttempts = 5; // Limit attempts to find a new question
    
    do {
        randomCharacterIndex = Math.floor(Math.random() * translationData.length);
        const selectedCharacter = translationData[randomCharacterIndex];
        randomSentenceIndex = Math.floor(Math.random() * selectedCharacter.sentences.length);
        questionKey = `${randomCharacterIndex}-${randomSentenceIndex}`;
        attempts++;
    } while (recentlyUsedQuestions.includes(questionKey) && attempts < maxAttempts);
    
    // Store the selected question in recently used list
    recentlyUsedQuestions.push(questionKey);
    if (recentlyUsedQuestions.length > maxRecentQuestions) {
        recentlyUsedQuestions.shift(); // Remove oldest question
    }
    
    // Get the selected character and sentence
    const selectedCharacter = translationData[randomCharacterIndex];
    const sentenceData = selectedCharacter.sentences[randomSentenceIndex];
    
    // Store current selections
    currentCharacterIndex = randomCharacterIndex;
    currentSentenceIndex = randomSentenceIndex;
    
    // Update character image with SVG
    const characterIcon = characterIcons[selectedCharacter.character] || characterIcons.default;
    characterImage.style.backgroundImage = `url('${characterIcon}')`;
    
    // Update English text
    englishText.textContent = sentenceData.english;

    // Get the correct Spanish translation
    const correctOption = sentenceData.spanish;
    currentCorrectOption = correctOption;
    
    // Get random incorrect options from other sentences
    const incorrectOptions = getRandomIncorrectOptions(selectedCharacter, randomSentenceIndex);
    
    // Create and shuffle Spanish options
    const options = [correctOption, ...incorrectOptions];
    shuffleArray(options);
    
    // Add options to the container
    options.forEach((option) => {
        const optionElement = document.createElement('div');
        optionElement.className = 'spanish-option';
        optionElement.textContent = option;
        optionElement.addEventListener('click', function() {
            // Cancel any ongoing speech
            window.speechSynthesis.cancel();
            
            // Flag to track if this is the correct option (for waiting on speech)
            const isCorrect = option === currentCorrectOption;
            
            // Speak the Spanish text before checking the answer
            speakSpanishText(option, function() {
                // This will only run after speech completes
                if (isCorrect) {
                    // Give a short delay after speech completes before moving to next question
                    setTimeout(() => {
                        loadQuestion();
                    }, 1000);
                }
            });
            
            // Check the answer immediately (don't wait for speech to finish)
            checkAnswer(option, this);
        });
        spanishOptions.appendChild(optionElement);
    });
}

// Get random incorrect options from other sentences
function getRandomIncorrectOptions(characterData, currentIndex) {
    // Create a pool of all sentences excluding the current one
    let sentencePool = [];
    
    // Add sentences from the current character (except the current sentence)
    characterData.sentences.forEach((sentence, idx) => {
        if (idx !== currentIndex) {
            sentencePool.push(sentence);
        }
    });
    
    // Add sentences from other characters if needed
    if (sentencePool.length < 2) {
        translationData.forEach((charData, idx) => {
            if (idx !== currentCharacterIndex) {
                sentencePool = sentencePool.concat(charData.sentences);
            }
        });
    }
    
    // Shuffle the pool and take the first 2
    shuffleArray(sentencePool);
    
    return sentencePool.slice(0, 2).map(sentence => sentence.spanish);
}

function checkAnswer(selectedOption, selectedElement) {
    if (selectedOption === currentCorrectOption) {
        selectedElement.classList.add('correct');
        correctCount++;
        correctCountDisplay.textContent = correctCount;

        // Show celebration animation
        showCelebration();
        
        // IMPORTANT: Show the matching game modal 
        // after a brief delay to allow celebration animation to be visible
        setTimeout(() => {
            showMatchingGame();
        }, 1200);
        
        // Don't call loadQuestion() here - it should only be called 
        // after completing the matching game
    } else {
        // Incorrect answer
        selectedElement.classList.add('incorrect');
        
        // Find the English translation for this incorrect Spanish option
        let translationFound = false;
        
        // Search through all characters and sentences
        for (const character of translationData) {
            for (const sentence of character.sentences) {
                if (sentence.spanish === selectedOption) {
                    // Create or update translation hint
                    let hintElement = document.querySelector('.translation-hint');
                    if (!hintElement) {
                        hintElement = document.createElement('div');
                        hintElement.className = 'translation-hint';
                        spanishOptions.insertAdjacentElement('afterend', hintElement);
                    }
                    
                    hintElement.innerHTML = `
                    <p><strong>This actually means:</strong></p>
                    <p>"${sentence.english}"</p>
                    <p>Try again to find the correct match!</p>
                    `;
                    
                    translationFound = true;
                    break;
                }
            }
            if (translationFound) break;
        }
        
        // Remove the incorrect class after animation finishes
        setTimeout(function() {
            selectedElement.classList.remove('incorrect');
        }, 500);
    }
}

// Ensure voices are loaded (voices may load asynchronously)
if ("speechSynthesis" in window) {
  window.speechSynthesis.onvoiceschanged = function () {
    window.speechSynthesis.getVoices();
  };
}
    
function narrateSentence(sentence, callback) {
  speakSpanishText(sentence, callback);
}


// Function to speak Spanish text and allow callback when complete
function speakSpanishText(text, callback) {
  if (!("speechSynthesis" in window)) {
    console.warn("Speech synthesis not supported.");
    if (typeof showSpeechNotAvailable === "function") showSpeechNotAvailable();
    return;
  }

  const voices = window.speechSynthesis.getVoices();

  // Prefer a high-quality *female* Spanish voice if we can identify one.
  // IMPORTANT: If we can't confidently identify one, DO NOT force a voice.
  // Let the browser choose its default (often the best / most natural).
  const preferred = pickPreferredSpanishVoice(voices);

  const utterance = new SpeechSynthesisUtterance(text);

  // Keep language Spanish, but avoid "pinning" to a bad es-ES voice.
  utterance.lang = "es-ES";

  if (preferred) {
    utterance.voice = preferred;
  }

  utterance.rate = 1.0;
  utterance.pitch = 1.0;
  utterance.volume = 1.0;

  utterance.onend = function () {
    if (callback) callback();
  };

  window.speechSynthesis.cancel();
  window.speechSynthesis.speak(utterance);
}

// Heuristic: try hard to find a female Spanish voice, but don't guess poorly.
function pickPreferredSpanishVoice(voices) {
  if (!voices || !voices.length) return null;

  // 1) Any voice explicitly marked "Female" in name (some platforms do this)
  let v =
    voices.find(x => x.lang && x.lang.startsWith("es") && /female/i.test(x.name)) ||
    null;
  if (v) return v;

  // 2) Common female Spanish voice names across Apple / Microsoft / Google ecosystems
  // (If none exist on your system, we return null and let the browser pick.)
  const preferredNameHints = [
    "Monica", "Paulina", "Helena", "Sabina", "Laura", "Elena",
    "Conchita", "Penelope", "Luciana", "Catalina"
  ];

  v =
    voices.find(x =>
      x.lang && x.lang.startsWith("es") &&
      preferredNameHints.some(h => x.name && x.name.toLowerCase().includes(h.toLowerCase()))
    ) || null;

  return v;
}

// Show celebration animation
function showCelebration() {
    celebration.style.display = 'block';
    celebration.innerHTML = '';
    
    // Create confetti
    for (let i = 0; i < 50; i++) {
        const confetti = document.createElement('div');
        confetti.className = 'confetti';
        confetti.style.left = `${Math.random() * 100}%`;
        confetti.style.animationDuration = `${2 + Math.random() * 2}s`;
        confetti.style.backgroundColor = getRandomColor();
        celebration.appendChild(confetti);
    }
    
    // Hide celebration after animation
    setTimeout(function() {
        celebration.style.display = 'none';
    }, 4000);
}

// Helper functions
function shuffleArray(array) {
    for (let i = array.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [array[i], array[j]] = [array[j], array[i]];
    }
    return array;
}

function getRandomColor() {
    const colors = ['#ff0000', '#00ff00', '#0000ff', '#ffff00', '#ff00ff', '#00ffff'];
    return colors[Math.floor(Math.random() * colors.length)];
}
// Show the segment-matching game
function showMatchingGame() {
  console.log("showMatchingGame() called");

  const selectedCharacter = translationData[currentCharacterIndex];
  const sentenceData = selectedCharacter.sentences[currentSentenceIndex];

  console.log("Character:", selectedCharacter.character);
  console.log("Sentence:", sentenceData.english);
  console.log("Has segments:", !!sentenceData.segments);

  // If this sentence has no segment data, just move on
  if (!sentenceData.segments) {
    console.log("No segments found - loading next question");
    setTimeout(() => {
      loadQuestion();
    }, 1500);
    return;
  }

  // Set original Spanish sentence at the top
  document.getElementById('original-sentence').textContent =
    sentenceData.spanish;

  // Clear any previous content
  const englishComponentsEl = document.getElementById('english-components');
  const spanishOptionsEl    = document.getElementById('spanish-options-matching');
  const resultMsgEl         = document.getElementById('match-result-message');

  englishComponentsEl.innerHTML = '';
  spanishOptionsEl.innerHTML    = '';
  resultMsgEl.textContent       = '';

  // Segment arrays
  const spanishSegments = sentenceData.segments.spanish;
  const englishSegments = sentenceData.segments.english;

  // Build English “slots” + dropzones
  englishSegments.forEach((segment, index) => {
    const matchContainer = document.createElement('div');
    matchContainer.className = 'match-container';

    const englishComponent = document.createElement('div');
    englishComponent.className = 'english-component';
    englishComponent.textContent = segment;

    const spanishDropzone = document.createElement('div');
    spanishDropzone.className = 'spanish-dropzone';
    spanishDropzone.dataset.correct = spanishSegments[index];

    matchContainer.appendChild(englishComponent);
    matchContainer.appendChild(spanishDropzone);
    englishComponentsEl.appendChild(matchContainer);
  });

  // Add Spanish draggable options (shuffled)
  const shuffledSpanishSegments = [...spanishSegments];
  shuffleArray(shuffledSpanishSegments);

  shuffledSpanishSegments.forEach(segment => {
    const draggable = document.createElement('div');
    draggable.className = 'draggable';
    draggable.draggable = true;
    draggable.textContent = segment;
    draggable.onclick = () => speakSpanishSegment(segment);

    spanishOptionsEl.appendChild(draggable);
  });

  // Initialize drag and drop
  initDragAndDrop();

  // Wire up the “Check Matches” button
  const checkButton = document.getElementById('check-matches-btn');
  if (checkButton) {
    console.log("Found check button, adding click handler");
    checkButton.onclick = checkMatches;
  } else {
    console.log("Check button not found!");
  }

  console.log("Showing matching game modal");
  document.getElementById('matching-modal-overlay').style.display = 'flex';
}
    
    // Add Spanish draggable options
    const shuffledSpanishSegments = [...spanishSegments];
    shuffleArray(shuffledSpanishSegments);
    
    shuffledSpanishSegments.forEach(segment => {
        const draggable = document.createElement('div');
        draggable.className = 'draggable';
        draggable.draggable = true;
        draggable.textContent = segment;
        draggable.onclick = () => speakSpanishSegment(segment);
        
        document.getElementById('spanish-options-matching').appendChild(draggable);
    });
    
    // Initialize drag and drop
    initDragAndDrop();
    
    // Set up Check Matches button
    const checkButton = document.getElementById('check-matches-btn');
    if (checkButton) {
        console.log("Found check button, adding click handler");
        checkButton.onclick = checkMatches;
    } else {
        console.log("Check button not found!");
    }
    
    // Show the modal
    document.getElementById('matching-modal-overlay').style.display = 'flex';

// Function to speak Spanish segment
function speakSpanishSegment(text) {
    if ('speechSynthesis' in window) {
        // Cancel any ongoing speech
        window.speechSynthesis.cancel();
        
        // Create a new utterance
        const utterance = new SpeechSynthesisUtterance(text);
        
        // Set language to Spanish
        utterance.lang = 'es-ES';
        
        // Get available voices
        const voices = window.speechSynthesis.getVoices();
        
        // Try to find a female Spanish voice
        const spanishFemaleVoice = voices.find(voice => 
            voice.lang.includes('es') && voice.name.includes('Female'));
        
        // Use the Spanish female voice if found
        if (spanishFemaleVoice) {
            utterance.voice = spanishFemaleVoice;
        }
        
        // Visual feedback
        const element = document.querySelector('.draggable:hover, .draggable:active');
        if (element) {
            element.classList.add('speaking');
            setTimeout(() => element.classList.remove('speaking'), 500);
        }
        
        // Speak the text
        window.speechSynthesis.speak(utterance);
    }
}

// Initialize drag and drop functionality
function initDragAndDrop() {
    const draggables = document.querySelectorAll('.draggable');
    const dropzones = document.querySelectorAll('.spanish-dropzone');
    
    let draggedElement = null;
    
    // Add event listeners to draggable elements
    draggables.forEach(draggable => {
        draggable.addEventListener('dragstart', () => {
            draggable.classList.add('dragging');
            draggedElement = draggable;
        });
        
        draggable.addEventListener('dragend', () => {
            draggable.classList.remove('dragging');
        });
    });
    
    // Add event listeners to dropzones
    dropzones.forEach(dropzone => {
        dropzone.addEventListener('dragover', e => {
            e.preventDefault();
            dropzone.classList.add('highlight');
        });
        
        dropzone.addEventListener('dragleave', () => {
            dropzone.classList.remove('highlight');
        });
        
        dropzone.addEventListener('drop', e => {
            e.preventDefault();
            dropzone.classList.remove('highlight');
            
            // If dropzone already has content, return that content to options
            if (dropzone.children.length > 0) {
                const existingDraggable = dropzone.children[0];
                document.querySelector('#spanish-options-matching').appendChild(existingDraggable);
            }
            
            // Add the dragged element to the dropzone
            if (draggedElement) {
                dropzone.appendChild(draggedElement);
                
                // Pronounce the Spanish phrase when dropped
                speakSpanishSegment(draggedElement.textContent);
            }
        });
    });
}

// Check if the matching is correct
function checkMatches() {
    const dropzones = document.querySelectorAll('.spanish-dropzone');
    let allCorrect = true;
    let allFilled = true;
    const resultMessage = document.getElementById('match-result-message');
    const checkButton = document.getElementById('check-matches-btn');
    
    dropzones.forEach(dropzone => {
        // Remove previous validation classes
        dropzone.classList.remove('correct-match', 'incorrect-match');
        
        const correctText = dropzone.dataset.correct;
        
        // Check if there's a match in the dropzone
        if (dropzone.children.length > 0) {
            const droppedText = dropzone.children[0].textContent;
            
            if (droppedText === correctText) {
                // Correct match
                dropzone.classList.add('correct-match');
            } else {
                // Incorrect match
                dropzone.classList.add('incorrect-match');
                allCorrect = false;
                
                // Play error sound
                const errorSound = new Audio('data:audio/wav;base64,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qJrx4KOQjahZxWbcZgztj2c49nKmkId44S71j0c8eV9yDK6uPRzx5X18eDvjvQ6yKo9ZSS6l//8elePK/Lf//IInrOF/FvDoADYAGBMGb7FtErm5MXMlmPAJQVgWta7Zx2go+8xJ0UiCb8LHHdftWyLJE0QIAIsI+UbXu67dZMjmgDGCGl1H+vpF4NSDckSIkk7Vd+sxEhBQMRU8j/12UIRhzSaUdQ+rQU5kGeFxm+hb1oh6pWWmv3uvmReDl0UnvtapVaIzo1jZbf/pD6ElLqSX+rUmOQNpJFa/r+sa4e/pBlAABoAAAAA3CUgShLdGIxsY7AUABPRrgCABdDuQ5GC7DqPQCgbbJUAoRSUj+NIEig0YfyWUho1VBBBA//uQZB4ABZx5zfMakeAAAAmwAAAAF5F3P0w9GtAAACfAAAAAwLhMDmAYWMgVEG1U0FIGCBgXBXAtfMH10000EEEEEECUBYln03TTTdNBDZopopYvrTTdNa325mImNg3TTPV9q3pmY0xoO6bv3r00y+IDGid/9aaaZTGMuj9mpu9Mpio1dXrr5HERTZSmqU36A3CumzN/9Robv/Xx4v9ijkSRSNLQhAWumap82WRSBUqXStV/YcS+XVLnSS+WLDroqArFkMEsAS+eWmrUzrO0oEmE40RlMZ5+ODIkAyKAGUwZ3mVKmcamcJnMW26MRPgUw6j+LkhyHGVGYjSUUKNpuJUQoOIAyDvEyG8S5yfK6dhZc0Tx1KI/gviKL6qvvFs1+bWtaz58uUNnryq6kt5RzOCkPWlVqVX2a/EEBUdU1KrXLf40GoiiFXK///qpoiDXrOgqDR38JB0bw7SoL+ZB9o1RCkQjQ2CBYZKd/+VJxZRRZlqSkKiws0WFxUyCwsKiMy7hUVFhIaCrNQsKkTIsLivwKKigsj8XYlwt/WKi2N4d//uQRCSAAjURNIHpMZBGYiaQPSYyAAABLAAAAAAAACWAAAAApUF/Mg+0aohSIRobBAsMlO//Kk4soosy1JSFRYWaLC4qZBYWFRGZdwqKiwkNBVmoWFSJkWFxX4FFRQWR+LsS4W/rFRb/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////VEFHAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAU291bmRib3kuZGUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAMjAwNGh0dHA6Ly93d3cuc291bmRib3kuZGUAAAAAAAAAACU=');
                errorSound.play();
            }
        } else {
            // No match provided
            allFilled = false;
        }
    });
    
        // Update result message and button
    if (!allFilled) {
        resultMessage.textContent = "Please match all phrases before checking.";
        resultMessage.style.color = "blue";
    } else if (allCorrect) {
        resultMessage.textContent = "¡Excelente! All matches are correct!";
        resultMessage.style.color = "green";

        // Prevent extra clicks while we advance
        checkButton.disabled = true;

        // Celebration animation / effect
        showCelebration();

        // Auto-advance to the next question after a short pause
        setTimeout(() => {
            // Close the matching modal
            document.getElementById('matching-modal-overlay').style.display = 'none';

            // Re-enable button for the next round
            checkButton.disabled = false;
            checkButton.textContent = "Check matches";

            // Load the next question
            loadQuestion();
        }, 800); // 0.8 seconds; tweak if you want a longer/shorter pause
    } else {
        resultMessage.textContent = "Try again! Some matches are incorrect.";
        resultMessage.style.color = "red";
    }
}

</script>
</body>
</html>
